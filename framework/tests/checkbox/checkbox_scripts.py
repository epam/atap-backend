execute_on_promise_script = """
    !function(){var timeout=function(callback,stopCondition,callbackValue,ms){setTimeout(promise=>{if(console.log(`${ms}`),window.onPromise=!1,window.maxTries=200,window.tryNum=window.tryNum||1,promise=new Promise((resolve,reject)=>{eval(stopCondition)?(window.onPromise=!0,resolve(window.prom)):reject()}),promise.then(o=>{},o=>{}),!(0==window.onPromise&&window.tryNum<window.maxTries))return window.tryNum=0,callback(eval(callbackValue)),!1;window.tryNum++,timeout(callback,stopCondition,callbackValue,ms)},ms)};window.Timeout=timeout}();
"""

jquery_check_script = """
    !function(){var e=function(){try{return jQuery,!0}catch(e){return!1}};e()||(document.head.appendChild(document.createElement("script")).src="https://code.jquery.com/jquery-3.6.0.min.js");window.withJQuery=e}();
"""

locator_visible_script = """
    var isVisible=function(e){return void 0!==e.offsetParent?e.offsetWidth>3&&e.offsetHeight>3&&null!==e.offsetParent:e.getBoundingClientRect().width>3&&e.getBoundingClientRect().height>3};window.locatorVisible=[...document.body.getElementsByTagName("*")].filter(e=>arguments[0].includes(e.tagName)&&isVisible(e));
"""

illegal_label_script = """
    !function(){"use strict";class t{constructor(t){this.top=t.offsetTop,this.left=t.offsetLeft,this.leftX=jQuery(t).offset().left,this.rightX=this.leftX+t.offsetWidth,this.centerX=(this.leftX+this.rightX)/2,this.topY=jQuery(t).offset().top,this.bottomY=this.topY+t.offsetHeight,this.centerY=(this.topY+this.bottomY)/2}static fourSideDirection(t,e){var n=Math.abs(t.top-e.top)>Math.abs(t.left-e.left)?-2:-1;return n=-2===n?n*Math.sign(t.top-e.top)+2:n*Math.sign(t.left-e.left)+2,new Object({0:"top",1:"left",4:"bottom",3:"right"})[n]}static minAbscissa(t,e){var n=[t.centerX-e.centerX,t.leftX-e.centerX,t.rightX-e.centerX,t.centerX-e.leftX,t.leftX-e.leftX,t.rightX-e.leftX,t.centerX-e.rightX,t.leftX-e.rightX,t.rightX-e.rightX];return n.forEach((t,e,n)=>{n[e]=t**2}),Math.min.apply(Math,n)}static minOrdinates(t,e){var n=[t.centerY-e.centerY,t.topY-e.centerY,t.bottomY-e.centerY,t.centerY-e.topY,t.topY-e.topY,t.bottomY-e.topY,t.centerY-e.bottomY,t.topY-e.bottomY,t.bottomY-e.bottomY];return n.forEach((t,e,n)=>{n[e]=t**2}),Math.min.apply(Math,n)}}var e=function(t){return void 0!==t.offsetParent?t.offsetWidth>3&&t.offsetHeight>3&&null!==t.offsetParent:t.getBoundingClientRect().width>3&&t.getBoundingClientRect().height>3},n=function(t=document.body,n=!1){var i=function(t){var n,i=[],o=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,null,!1);for(;n=o.nextNode();)s(n)&&e(n)&&i.push(n);return i}(t);const o=i.length;function r(t){return t.replace(/[&$][a-z]+;/gi,"").trim()}function s(t){var e=t.innerHTML;return e=r(e),e=e.replace(/(<([^>]+)>)/gi,"").replace(/.+>$/gi,""),/\w+/.test(e)}return(i=1==n&&s(t)?i.concat([t]):i).forEach(t=>{const e=function(t){var e,n,i=[],o=[...t.childNodes].filter(t=>t.nodeType===Node.TEXT_NODE&&r(t.textContent));if(!o.length)return null;for(const t of o)(n=t.parentElement.getAttribute("message"))&&n.startsWith("this span is for dev")?i.push(t.parentElement):(e=document.createElement("span"),t.parentNode.insertBefore(e,t),e.appendChild(t),e.setAttribute("message","this span is for dev to wrap the text node"),i.push(e));return i}(t);e&&i.push(...e)}),i=i.slice(o)};window.isVisible=e,window.minDistBetween=function(e,n){return e=new t(e),n=new t(n),t.minAbscissa(e,n)+t.minOrdinates(e,n)},window.moveFromTo=function(e,n){return e=new t(e),n=new t(n),t.fourSideDirection(e,n)},window.collectText=n,window.rollbackSpanTexts=function(){[...document.getElementsByTagName("SPAN")].filter(t=>t.getAttribute("message")&&t.getAttribute("message").startsWith("this span is for dev")).forEach(t=>{t.replaceWith(t.textContent)})},window.correctedCheckboxes=function(t){return t.map(t=>{var e,i=[],o=[];return t.forEach(t=>{i.push(...n(t,!0)),o.push(t),o.push(...t.getElementsByTagName("*")),o=o.filter(t=>!i.some(e=>t===e)).reduce((t,e)=>"INPUT"===e.tagName?[e,...t]:[...t,e],[]),e=o[0]}),e})},window.getGroupLabel=function(t,e,n,i){var o;const r="BODY"===t.tagName?t:t.parentElement;var s=window.collectText(r,!0);(s=[...new Set(s.map(t=>"CODE"!==t.parentElement.tagName?t.parentElement:t.parentElement.parentElement))]).sort((e,n)=>window.minDistBetween(t,e)-window.minDistBetween(t,n)),s=(s=s.filter(e=>Math.abs(t.getBoundingClientRect().top-e.getBoundingClientRect().bottom)<Math.min(70,t.offsetHeight/2)&&e.offsetHeight<2.5*parseInt(window.getComputedStyle(e).fontSize))).filter(e=>Array.prototype.slice.call(t.parentElement.getElementsByTagName("*")).includes(e)&&!i.includes(e));for(const e of s.slice(0,2))for(const i of n)window.minDistBetween(i,e)>=window.minDistBetween(t,e)&&(o=o||e);if(!(o=o||s[0]))return null;for(const t of e)if(window.minDistBetween(t,o)<window.minDistBetween(t,o)){o=null;break}return o||null},window.getCheckboxLabel=function(t){const e=window.collectText();var n,i=[],o=[],r=[];for(const n of t){var s=e,a=Math.min(n.offsetWidth,n.offsetHeight);s.sort((t,e)=>window.minDistBetween(n,t)-window.minDistBetween(n,e)),s=s.filter(t=>t!==n&&t.offsetHeight<2.5*parseInt(window.getComputedStyle(t).fontSize)&&window.minDistBetween(n,t)<4*a**2),!![...n.parentElement.children].filter(t=>"BR"===t.tagName).length&&(s=[n]),i.push(s)}for(const e in i){var f=(s=(s=i[e]).filter(e=>!t.some(t=>t===e)))[0];n=null,0!==s.length?((o=[...t]).sort((t,e)=>window.minDistBetween(t,f)-window.minDistBetween(e,f)),o[0]===t[e]&&(n=f),r.push(n)):r.push(n)}return r}}();
"""

group_verification_script = """
    !function(){"use strict";window.collectInteractive=function(){var e=[],t=[...document.images,...document.forms,...document.links],o=document.evaluate('//*[self::audio or self::video or self::input or self::button or\n                    self::select or self::textarea or self::menu or\n                    name()="svg" or self::span or self::iframe]',document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(let t=0,n=o.snapshotLength;t<n;++t)e.push(o.snapshotItem(t));return t=[...t,...e].filter(e=>window.isVisible(e))},window.findLesserGroups=function(e,t){var o=[];const n=window.getCheckboxLabel(e);var i,r,c=[],l=[],d=[];for(const t of e){i=1/0;for(const o of e.filter(e=>e!==t))i=Math.min(i,window.minDistBetween(t,o)),r=window.moveFromTo(t,o);c.push(i),l.push(r)}window.prohibited=new Set,window.collectText().forEach(e=>{window.prohibited.add(e)}),window.collectInteractive().forEach(e=>{window.prohibited.add(e)}),window.prohibited=[...window.prohibited],window.prohibited=window.prohibited.filter(o=>[...t.getElementsByTagName("*")].includes(o)&&!n.includes(o)&&!e.includes(o)&&"SPAN"!==o.tagName&&"DIV"!==o.tagName);for(const t in c)window.prohibited.map(o=>window.minDistBetween(e[t],o)).some(o=>o<c[t]&&window.moveFromTo(e[t],window.prohibited[t])===l[t])&&(c[t]=1/0);for(;c.length;)i=c[0],o.push(Array.from(c.filter(e=>e>.75*i&&e<1.25*i),(e,t)=>t)),d=i!==1/0?o[o.length-1]:[0],o[o.length-1]=d.map(t=>e[t]),d.forEach((t,o)=>{o=d.length-o-1,c.splice(o,1),e.splice(o,1)});return o=o.filter(e=>e.length>1)},window.whichIndeterminate=function(e){const t=e.map(()=>[]);var o,n=[];function i(e){var t=[],[o,n,i]=[{},{},{}],r=[...e.children].concat([e]);function c(e,t){var o=[e.filter(e=>!t.some(t=>t===e)),t.filter(t=>!e.some(e=>e===t))];return[...new Set(o[0].concat(o[1]))]}for(const l of r)if(o=window.getDefaultComputedStyle(l),e.click(),i=window.getComputedStyle(l,":after"),e.click(),n=window.getComputedStyle(l,":before"),[o,n,i]=[o,n,i].map(e=>[...e].map(t=>e[t])),(t=(t=c(o,n)).length?t:c(o,i)).length)break;return t}function r(e){let t=[],o=!1;const n=e=>(e=>"true"===e)(e.getAttribute("aria-checked"));return"INPUT"===e.tagName&&"checkbox"===e.type?(o=!!e.checked,e.click(),o=(o||!e.checked)&&!(o&&e.checked)&&!(!o&&!e.checked)):void 0!==e.getAttribute("aria-checked")?(o=n(e),e.click(),o=(o||!n(e))&&!(o&&n(e))&&!(!o&&!n(e))):(t=i(e).length,e.click(),o=!(0===t||t<=i(e).length)),e.click(),o}function c(e){for(const t of e)r(t)&&t.click()}for(const i in e)c(e),(o=e[i]).click(),(n=e.filter(e=>e!==o&&1==r(e))).length&&(t[i].push(...n),t[i].push({indeterminate:o}));return t.filter(e=>e.length)}}();
"""
